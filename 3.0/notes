## Requirements
Raspberry Pi Os, Raspberry Pi 3b
JLink Arm: Check 32/64bit! 
https://www.segger.com/downloads/jlink/JLink_Linux_arm64.deb tried with version 7.88J
https://www.segger.com/downloads/jlink/JLink_Linux_arm.tgz 

Raspberry Pi Preparation: 
- copy udev rules
- add JLink to Path
- disable act led in /boot/config.txt:
dtparam=act_led_trigger=none
dtparam=act_led_activelow=off
- create service
sudo cp /home/media/XXX /lib/systemd/system/
sudo systemctl --force --full edit cm3prod.service
sudo systemctl enable cm3prod.service
systemctl status cm3prod.service
sudo systemctl reboot

Beobachtungen 10.7.23
- wenn bei kopiervorgang power getrennt wird, steht success
  - problem von cp, kann mit cp nicht anders gelöst werden
  - rsync kopiert nicht zuverlässig
  - pyocd ist zulangsam (20s > 12s)
  -> bleibt erstmal bei cp
- bei erstem kopieren und erstem recover versuch steht fail
  -> gelöst mit 2 facher ausführung von SWDReadAP 2 (CTRL-AP Bank 0, erase all status) und wartezeiten
- rsync startet programm erst korrekt und zeigt dann error 504
  -> rsync nicht verwenden
- JLinkExe Command not found obwohl JLinkExe in Path
  - nur in .bashrc?
  -> JLink Verzeichnis in Path im Service realisieren
- Prüfen ob exit erfolgt?
  - durch checken ob mini noch gemounted ist? nach program übertragung connected daplink neu
  -> durch checken von vtref


Raspberry PI LEDs https://stackoverflow.com/questions/19863723/turn-off-leds-of-raspberry-pi
sudo chmod 666 /sys/class/leds/led0/brightness
echo 1 > /sys/class/leds/led0/brightness 

JLinkExe -NoGui 1 -device NRF52820_xxAA -Commandfile erase.jlink
JLinkExe -NoGui 1 -device NRF52820_xxAA -Commandfile flashing.jlink
rsync -av --progress --stats dest microbit-prodtest_mockup.hex /media/hugo/MINI/

JLinkExe -NoGui 1 -device NRF52820_xxAA -Commandfile erase.jlink; 
echo "successfully recovered and erased NRF52820"
JLinkExe -NoGui 1 -device NRF52820_xxAA -Commandfile flash.jlink; 
echo "successfully flashed DAPLINK"
echo "wait for seconds until device is ready
"; 
sleep 6; 
rsync -av --progress --stats dest microbit-prodtest_mockup.hex /media/hugo/MINI/;
echo "SUCCESS";
echo 1 > /sys/class/leds/led0/brightness


dauert 22s

JLinkExe -device NRF52820_XXAA -CommandFile commandfile.jlink 


https://devzone.nordicsemi.com/f/nordic-q-a/12484/approtect-and-dap
es braucht so ein vorconnect zustand, deswegen  "-if SWD -speed 40000 -autoconnect 1" nicht in command, swd interface erst danach auswählen

https://wiki.segger.com/UM08001_J-Link_/_J-Trace_User_Guide#Reset_unlock_message_box

Debug Power is 5V!!

